language: node_js

services:
  - docker

addons:
  ssh_known_hosts:
    - $PUBLICIP

before_deploy:
  - docker build -t hmarks/chucknorris .

deploy:
  provider: script
  script: bash docker_push

after_deploy:
  provider: script
  script:
    - echo $PASSWORD\n | ssh $USERNAME@$PUBLICIP
    - sleep 30
    - bash /tmp/build.sh
  on:
    branch: dev
